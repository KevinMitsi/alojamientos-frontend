<form
  [formGroup]="form"
  class="login-card"
  (ngSubmit)="resetPassword()"
>
  <h2 class="text-center fw-bold mb-3">Cambiar Contraseña</h2>
  <p class="text-center text-secondary mb-4">Ingresa tu nueva contraseña</p>

  <!-- NUEVA CONTRASEÑA -->
  <div class="form-group">
    <div class="input-container">
      <label for="newPassword" class="form-label" style="display: flex; align-items: center; gap: 8px;">
        <i class="bi bi-lock"></i>
        Nueva contraseña
      </label>
      <input
        type="password"
        id="newPassword"
        formControlName="newPassword"
        class="form-control"
        placeholder="Nueva contraseña"
        [class.is-invalid]="newPassword?.invalid && (newPassword?.touched || newPassword?.dirty)"
        minlength="8"
        maxlength="20"
      />
    </div>
    @if (newPassword?.invalid && (newPassword?.touched || newPassword?.dirty)) {
      <div class="invalid-feedback d-block">
        @if (newPassword?.errors?.['required']) {
          <span>La contraseña es obligatoria.</span>
        }
        @if (newPassword?.errors?.['minlength']) {
          <span>Mínimo 8 caracteres.</span>
        }
        @if (newPassword?.errors?.['maxlength']) {
          <span>Máximo 20 caracteres.</span>
        }
        @if (newPassword?.errors?.['passwordStrength']) {
          <div class="password-requirements">
            <span>La contraseña debe contener:</span>
            <ul>
              <li [class.valid]="newPassword?.errors?.['passwordStrength'].hasUpperCase">
                <i [class.bi-check-circle-fill]="newPassword?.errors?.['passwordStrength'].hasUpperCase" 
                   [class.bi-x-circle-fill]="!newPassword?.errors?.['passwordStrength'].hasUpperCase" 
                   class="bi"></i>
                Al menos una letra mayúscula
              </li>
              <li [class.valid]="newPassword?.errors?.['passwordStrength'].hasNumber">
                <i [class.bi-check-circle-fill]="newPassword?.errors?.['passwordStrength'].hasNumber" 
                   [class.bi-x-circle-fill]="!newPassword?.errors?.['passwordStrength'].hasNumber" 
                   class="bi"></i>
                Al menos un número
              </li>
              <li [class.valid]="newPassword?.errors?.['passwordStrength'].hasSpecialChar">
                <i [class.bi-check-circle-fill]="newPassword?.errors?.['passwordStrength'].hasSpecialChar" 
                   [class.bi-x-circle-fill]="!newPassword?.errors?.['passwordStrength'].hasSpecialChar" 
                   class="bi"></i>
                Al menos un símbolo (@$!%*?&._-)
              </li>
            </ul>
          </div>
        }
      </div>
    }
  </div>

  <!-- CONFIRMAR CONTRASEÑA -->
  <div class="form-group">
    <div class="input-container">
      <label for="confirmPassword" class="form-label" style="display: flex; align-items: center; gap: 8px;">
        <i class="bi bi-lock-fill"></i>
        Confirmar contraseña
      </label>
      <input
        type="password"
        id="confirmPassword"
        formControlName="confirmPassword"
        class="form-control"
        placeholder="Confirmar contraseña"
        [class.is-invalid]="(confirmPassword?.invalid || form.errors?.['passwordMismatch']) && (confirmPassword?.touched || confirmPassword?.dirty)"
        minlength="8"
        maxlength="20"
      />
    </div>
    @if (confirmPassword?.invalid && (confirmPassword?.touched || confirmPassword?.dirty)) {
      <div class="invalid-feedback d-block">
        @if (confirmPassword?.errors?.['required']) {
          <span>Debes confirmar la contraseña.</span>
        }
      </div>
    }
    @if (form.errors?.['passwordMismatch'] && (confirmPassword?.touched || confirmPassword?.dirty || submitted)) {
      <div class="invalid-feedback d-block">
        <span>Las contraseñas no coinciden.</span>
      </div>
    }
  </div>

  <!-- BOTÓN -->
  <button type="submit" class="btn-login" [disabled]="loading">
    @if (!loading) {
      <span>Cambiar contraseña</span>
    }
    @if (loading) {
      <span><span class="spinner-border spinner-border-sm me-2"></span>Cambiando...</span>
    }
  </button>

  <!-- LINKS -->
  <div class="text-center mt-3">
    <a routerLink="/login" class="text-primary text-decoration-none small">Volver al inicio de sesión</a>
  </div>
</form>
