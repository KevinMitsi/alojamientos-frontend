<form
  [formGroup]="form"
  class="login-card"
>
  <h2 class="text-center fw-bold mb-3">Recuperar Contraseña</h2>
  <p class="text-center text-secondary mb-4">
    {{ !codeSent ? 'Ingresa tu correo electrónico para recibir un código de recuperación' : 'Ingresa el código de 6 dígitos que recibiste en tu correo' }}
  </p>

  <!-- EMAIL -->
  <div class="form-group">
    <div class="input-container">
      <label for="email" class="form-label" style="display: flex; align-items: center; gap: 8px;">
        <i class="bi bi-envelope"></i>
        Correo electrónico
      </label>
      <input
        type="email"
        id="email"
        formControlName="email"
        class="form-control"
        placeholder="Correo electrónico"
        [class.is-invalid]="email?.invalid && (email?.touched || email?.dirty)"
        [readonly]="codeSent"
      />
    </div>
    @if (email?.invalid && (email?.touched || email?.dirty)) {
      <div class="invalid-feedback d-block">
        @if (email?.errors?.['required']) {
          <span>El correo es obligatorio.</span>
        }
        @if (email?.errors?.['email']) {
          <span>Formato de correo inválido.</span>
        }
      </div>
    }
  </div>

  <!-- CÓDIGO (solo se muestra si ya se envió el email) -->
  @if (codeSent) {
    <div class="form-group">
      <div class="input-container">
        <label for="code" class="form-label" style="display: flex; align-items: center; gap: 8px;">
          <i class="bi bi-key"></i>
          Código de recuperación
        </label>
        <input
          type="text"
          id="code"
          formControlName="code"
          class="form-control"
          placeholder="Código de 6 dígitos"
          [class.is-invalid]="code?.invalid && (code?.touched || code?.dirty)"
          maxlength="6"
          pattern="[0-9]{6}"
        />
      </div>
      @if (code?.invalid && (code?.touched || code?.dirty)) {
        <div class="invalid-feedback d-block">
          <span>El código debe tener 6 dígitos numéricos.</span>
        </div>
      }
    </div>
  }

  <!-- BOTÓN -->
  @if (!codeSent) {
    <button type="button" class="btn-login" [disabled]="loading" (click)="requestReset()">
      @if (!loading) {
        <span>Recuperar mi contraseña</span>
      }
      @if (loading) {
        <span><span class="spinner-border spinner-border-sm me-2"></span>Enviando...</span>
      }
    </button>
  }

  @if (codeSent) {
    <button type="button" class="btn-login" (click)="verifyCode()">
      <span>Verificar código</span>
    </button>
    <button type="button" class="btn-login btn-secondary mt-2" (click)="codeSent = false; form.get('code')?.reset()">
      <span>Volver a enviar código</span>
    </button>
  }

  <!-- LINKS -->
  <div class="text-center mt-3">
    <a routerLink="/login" class="text-primary text-decoration-none small">Volver al inicio de sesión</a>
  </div>
</form>
