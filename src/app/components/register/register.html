<!-- TOAST (notificación flotante) -->
<div *ngIf="showToast" class="position-fixed top-0 end-0 p-3" style="z-index: 2000;">
  <div
    class="toast align-items-center text-white border-0 show"
    [ngClass]="toastType === 'success' ? 'bg-success' : 'bg-danger'">
    <div class="d-flex">
      <div class="toast-body">
        {{ toastMessage }}
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" (click)="showToast = false"></button>
    </div>
  </div>
</div>

<!-- FORMULARIO -->
<form [formGroup]="registerForm" class="login-card" (ngSubmit)="onSubmit()">
  <h2 class="mb-3 fw-bold text-primary text-center">Registro</h2>
  <p class="text-center text-muted mb-4">Crea tu cuenta</p>

  <!-- Nombre -->
  <div class="input-container mb-3">
    <i class="bi bi-person"></i>
    <input
      type="text"
      formControlName="name"
      class="form-control"
      placeholder="Nombre completo"
      maxlength="100"
      [class.is-invalid]="name?.invalid && (name?.touched || name?.dirty)" />
    @if (name?.invalid && (name?.touched || name?.dirty)) {
      <div class="invalid-feedback d-block">
        @if (name?.errors?.['required']) { <span>El nombre es obligatorio.</span> }
        @if (name?.errors?.['maxlength']) { <span>Máximo 100 caracteres.</span> }
      </div>
    }
  </div>

  <!-- Teléfono -->
  <div class="input-container mb-3">
    <i class="bi bi-telephone"></i>
    <input
      type="text"
      formControlName="phone"
      class="form-control"
      placeholder="Teléfono (opcional)"
      maxlength="10"
      [class.is-invalid]="phone?.invalid && (phone?.touched || phone?.dirty)" />
    @if (phone?.invalid && (phone?.touched || phone?.dirty)) {
      <div class="invalid-feedback d-block">
        @if (phone?.errors?.['maxlength']) { <span>Máximo 10 dígitos.</span> }
        @if (phone?.errors?.['pattern']) { <span>Solo se permiten números.</span> }
      </div>
    }
  </div>

  <!-- Correo electrónico -->
  <div class="input-container mb-3">
    <i class="bi bi-envelope"></i>
    <input
      type="email"
      formControlName="email"
      class="form-control"
      placeholder="Correo electrónico"
      maxlength="50"
      [class.is-invalid]="email?.invalid && (email?.touched || email?.dirty)" />
    @if (email?.invalid && (email?.touched || email?.dirty)) {
      <div class="invalid-feedback d-block">
        @if (email?.errors?.['required']) { <span>El correo es obligatorio.</span> }
        @if (email?.errors?.['email']) { <span>Formato inválido.</span> }
        @if (email?.errors?.['maxlength']) { <span>Máximo 50 caracteres.</span> }
      </div>
    }
  </div>

  <!-- Fecha de nacimiento -->
  <div class="input-container mb-3">
    <i class="bi bi-calendar"></i>
    <input
      type="date"
      formControlName="dateBirth"
      class="form-control"
      [class.is-invalid]="dateBirth?.invalid && (dateBirth?.touched || dateBirth?.dirty)" />
    @if (dateBirth?.invalid && (dateBirth?.touched || dateBirth?.dirty)) {
      <div class="invalid-feedback d-block">
        @if (dateBirth?.errors?.['required']) { <span>La fecha de nacimiento es obligatoria.</span> }
      </div>
    }
  </div>

  <!-- Contraseña -->
  <div class="input-container mb-3">
    <i class="bi bi-lock"></i>
    <input
      type="password"
      formControlName="password"
      class="form-control"
      placeholder="Contraseña"
      [class.is-invalid]="password?.invalid && (password?.touched || password?.dirty)" />
    @if (password?.invalid && (password?.touched || password?.dirty)) {
      <div class="invalid-feedback d-block">
        @if (password?.errors?.['required']) { <span>La contraseña es obligatoria.</span> }
        @if (password?.errors?.['minlength']) { <span>Mínimo 8 caracteres.</span> }
        @if (password?.errors?.['maxlength']) { <span>Máximo 20 caracteres.</span> }
      </div>
    }
  </div>

  <!-- Confirmar contraseña -->
  <div class="input-container mb-3">
    <i class="bi bi-lock-fill"></i>
    <input
      type="password"
      formControlName="confirmPassword"
      class="form-control"
      placeholder="Confirmar contraseña"
      [class.is-invalid]="registerForm.hasError('mismatch') && (confirmPassword?.touched || confirmPassword?.dirty)" />
    @if (registerForm.hasError('mismatch') && (confirmPassword?.touched || confirmPassword?.dirty)) {
      <div class="invalid-feedback d-block">
        <span>Las contraseñas no coinciden.</span>
      </div>
    }
  </div>

  <!-- Botón -->
  <button
    type="submit"
    class="btn btn-primary w-100 rounded-4 mt-2"
    [disabled]="loading">
    @if (!loading) {
      Registrarse
    } @else {
      Registrando...
    }
  </button>

  <div class="text-center mt-3">
    <a routerLink="/login" class="text-decoration-none text-primary fw-semibold">
      ¿Ya tienes cuenta? Inicia sesión
    </a>
  </div>
</form>
